---
title: "Cook County DCFS Analysis"
author: "Daniel P. Riggins, MD"
date: "1/21/2022"
output: html_document
---

## Next Steps

Remove hospital addresses

## Dependencies

```{r}
library(targets)
library(leaflet)
library(leaflet.extras)

```

```{r}
tar_make()
tar_load(cook_incidents_per_census_tract)
```

```{r}
dcfs_palette <-
    colorNumeric(
        palette = "magma",
        domain = cook_incidents_per_census_tract$count_incidents,
        reverse = TRUE,
    )

cook_incidents_per_census_tract |> 
    st_transform(4326) |> 
    leaflet() |> 
    addProviderTiles("CartoDB.Positron") |> 
    # Center and zoom the map to Cook County
    setView(lat = 41.816544, lng = -87.749500, zoom = 9) |> 
    # Add button to enable fullscreen map
    addFullscreenControl() |> 
    addPolygons(
        stroke = FALSE,
        # Color according to palette above
        fillColor = ~dcfs_palette(count_incidents),
        # Group polygons by number of deaths for use in the layer control
        group = ~ count_incidents,
        # Make slightly transparent
        fillOpacity = 0.5,
        # Click on the polygon to get its ID
        label = ~ paste0("FIPS ID: ", as.character(GEOID))
    ) |> 
    #Add legend
    addLegend(
        title = "Count of DCFS Abuse <br> or Neglect cases <br> per census tract <br> in Cook County, IL <br> from 2016-2021",
        values = ~ count_incidents,
        pal = dcfs_palette,
        position = "topright"
    )
```
